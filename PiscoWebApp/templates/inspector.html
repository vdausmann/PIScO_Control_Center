<html class="{{ theme }}">
{% extends "base.html" %}

{% block title %}HDF Inspector{% endblock %}

{% block content %}
<div class="panel">

<!-- <h2>HDF5 Inspector</h2> -->

<p style="text-align: left;"><b>File:</b> {{ file_path }}</p>


<div class="inspector-layout">

    <!-- LEFT COLUMN -->
    <section class="inspector-left" style="text-align: left;">
        <h2>Group: {{ hdf_path }}</h2>

        <!-- Attributes -->
		{% if attributes %}
		<table class="attr-table">
			<thead>
				<tr>
					<th>Name</th>
					<th>Value</th>
					<th>Type</th>
				</tr>
			</thead>
			<tbody>
			{% for a in attributes %}
				<tr>
					<td class="attr-key">{{ a.key }}</td>
					<td class="attr-value">
						<pre>{{ a.value }}</pre>
					</td>
					<td class="attr-type">{{ a.type }}</td>
				</tr>
			{% endfor %}
			</tbody>
		</table>
		{% else %}
			<p class="muted">No attributes</p>
		{% endif %}

		<div class="navigation-layout">
			<div>
				<h4>Datasets:</h4>
				{% if datasets %}
				<ul class="nav-list">
					{% for d in datasets %}
						<li>ğŸ“„ <a href="/inspect-data/{{ file_path }}?hdf_path={{ d.path }}"> {{ d.name }}</a></li>
					{% endfor %}
				</ul>
				{% else %}
					<p class="muted">No Datasets</p>
				{% endif %}
			</div>
			<div>
				<h4>Subgroups:</h4>
				{% if groups %}
				<ul class="nav-list">
					{% for g in groups %}
						<li>ğŸ“ <a href="/inspect/{{ file_path }}?hdf_path={{ g.path }}"> {{ g.name }}</a></li>
					{% endfor %}
				</ul>
				{% else %}
					<p class="muted">No Subgroups</p>
				{% endif %}
			</div>
		</div>
    </section>


		<aside class="inspector-right">

			<div id="plot-container">
				<div class="plot-placeholder">
					Loading plotâ€¦
				</div>
			</div>
			<!-- <div class="dataset-plot"> -->
			<!-- 	{{ plot_div | safe }} -->
			<!-- </div> -->


		<script>
			let plotLoaded = false;

			async function loadPlot() {
				if (plotLoaded) return;   // ğŸ”‘ prevent double calls
				plotLoaded = true;

				const container = document.getElementById("plot-container");
				container.innerHTML = ""; // ğŸ”‘ clear container explicitly

				const response = await fetch(
					"/plot/{{ file_path }}?hdf_path={{ hdf_path }}"
				);

				if (!response.ok) {
					container.innerText = "Failed to load plot.";
					return;
				}

				const figStr = await response.json();
				const fig = JSON.parse(figStr);

				Plotly.newPlot(
					container,
					fig.data,
					fig.layout,
					{ responsive: true }
				);
			}

			window.addEventListener("DOMContentLoaded", loadPlot);
		</script>


		</aside>
</div>
{% endblock %}
